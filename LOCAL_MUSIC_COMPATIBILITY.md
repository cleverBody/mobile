# 本地音乐功能兼容性说明

## 🎯 兼容性目标
- ✅ 浏览器开发环境 (localhost:8080)
- ✅ Android APK (Capacitor打包)
- ✅ 无需复杂依赖库
- ✅ 一次性完整解决方案

## 🔧 技术方案

### 1. 文件选择
- **浏览器环境**: HTML5 File API (`<input type="file">`)
- **移动端环境**: Capacitor FilePicker (动态导入)
- **兼容性**: 自动检测环境并使用对应API

### 2. 文件存储
- **统一方案**: IndexedDB (浏览器和Capacitor都支持)
- **优势**: 无需文件系统权限，兼容性最好
- **播放**: 使用Blob URL，Howler.js完全支持

### 3. 元数据解析
- **简化方案**: 文件名解析 (格式: "艺术家 - 歌曲名.mp3")
- **优势**: 无外部依赖，100%兼容
- **扩展**: 后续可添加更复杂的解析库

### 4. 音频播放
- **本地文件**: 使用HTML5音频 (`html5: true`)
- **在线音乐**: 使用Web Audio API (`html5: false`)
- **兼容性**: 移动端和浏览器都支持

## 📁 文件结构

```
mobile/src/
├── views/LocalMusic/
│   ├── Simple.vue          # 简化版本，完全兼容
│   └── index.vue           # 完整版本，功能丰富
├── utils/
│   ├── fileManager.ts      # 兼容浏览器和移动端
│   └── audioMetadata.ts    # 简化元数据解析
├── stores/
│   └── localMusic.ts       # 状态管理
└── types/
    └── localMusic.ts       # 类型定义
```

## 🚀 使用方式

### 开发环境 (浏览器)
1. 访问 `http://localhost:8080/local-music`
2. 点击导入按钮，选择音频文件
3. 自动解析文件名获取艺术家和歌曲信息
4. 使用IndexedDB存储，Blob URL播放

### 生产环境 (APK)
1. 相同的界面和操作流程
2. 自动使用Capacitor FilePicker选择文件
3. 相同的存储和播放机制
4. 完全兼容移动端

## 🎵 支持的音频格式
- MP3 (.mp3)
- M4A (.m4a)
- AAC (.aac)
- FLAC (.flac)
- WAV (.wav)
- OGG (.ogg)
- WMA (.wma)

## 📝 文件命名建议
为了更好的元数据识别，建议文件命名格式：
- `艺术家 - 歌曲名.mp3`
- `周杰伦 - 青花瓷.mp3`
- `Taylor Swift - Love Story.mp3`

## 🔄 升级路径
当前使用简化版本 (`Simple.vue`)，后续可以：
1. 添加更复杂的元数据解析库
2. 支持封面图片提取
3. 添加播放列表管理
4. 集成到主播放器系统

## ⚠️ 注意事项
1. **文件持久性**: 浏览器环境中，刷新页面后需要重新导入文件
2. **存储限制**: IndexedDB有存储配额限制
3. **格式支持**: 依赖浏览器的音频解码能力
4. **性能**: 大文件可能影响导入速度

## 🛠️ 故障排除

### 导入失败
- 检查文件格式是否支持
- 确认浏览器支持File API
- 检查存储空间是否充足

### 播放失败
- 确认文件格式被浏览器支持
- 检查Howler.js配置
- 查看浏览器控制台错误信息

### 移动端问题
- 确认Capacitor插件已正确安装
- 检查应用权限配置
- 查看原生日志输出
