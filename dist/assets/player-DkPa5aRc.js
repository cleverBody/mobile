import{d as C,r as i,e as p,u as E,aJ as P,aK as H,m as J}from"./index-C9U6OB9Y.js";const O=C("player",()=>{const c=i(!1),l=i(0),t=i(0),m=i(.8),v=i("order"),u=i(!1),n=i(null);let o=null,f=null;const k=p(()=>t.value>0?l.value/t.value*100:0),h=e=>{const r=Math.floor(e/60),a=Math.floor(e%60);return`${r}:${a.toString().padStart(2,"0")}`},w=p(()=>h(l.value)),T=p(()=>h(t.value)),s=E(),S=async e=>{try{const r=await J.getSongUrl(e);if(r.data&&r.data.length>0){const a=r.data.find(A=>A.id===e);return a!=null&&a.url?a.url:(console.warn("歌曲播放链接为空，可能因为版权限制:",a),null)}return null}catch(r){return console.error("获取歌曲URL失败:",r),null}},y=async e=>{try{o&&o.unload(),u.value=!0,n.value=null,l.value=0,t.value=0,o=new H.Howl({src:[e],html5:!0,volume:m.value,preload:!0,onload:()=>{u.value=!1,t.value=(o==null?void 0:o.duration())||0,console.log("音频加载完成，时长:",t.value)},onloaderror:(r,a)=>{console.error("音频加载失败:",a),u.value=!1,n.value="音频加载失败"},onplay:()=>{c.value=!0,I(),console.log("开始播放")},onpause:()=>{c.value=!1,d(),console.log("暂停播放")},onend:()=>{c.value=!1,d(),F(),console.log("播放结束")},onstop:()=>{c.value=!1,d(),l.value=0,console.log("停止播放")}})}catch(r){console.error("初始化播放器失败:",r),u.value=!1,n.value="初始化失败"}},g=()=>{if(o&&!u.value)try{o.play()}catch(e){console.error("播放失败:",e),n.value="播放失败"}},b=()=>{if(o)try{o.pause()}catch(e){console.error("暂停失败:",e)}},M=()=>{if(o)try{o.stop()}catch(e){console.error("停止失败:",e)}},N=e=>{if(o&&t.value>0)try{const r=Math.max(0,Math.min(e,t.value));o.seek(r),l.value=r}catch(r){console.error("跳转失败:",r)}},U=e=>{const r=Math.max(0,Math.min(e,1));if(m.value=r,o)try{o.volume(r)}catch(a){console.error("设置音量失败:",a)}},I=()=>{d(),f=window.setInterval(()=>{if(o&&c.value)try{const e=o.seek();typeof e=="number"&&(l.value=e)}catch(e){console.error("获取播放进度失败:",e),d()}},100)},d=()=>{f&&(clearInterval(f),f=null)},F=()=>{switch(v.value){case"order":s.hasNext&&x();break;case"random":const e=s.playlist;if(e.length>0){const r=Math.floor(Math.random()*e.length);s.currentIndex=r,s.setCurrentSong(e[r])}break;case"repeat":o&&(l.value=0,o.seek(0),o.play());break}},x=()=>{s.hasNext&&s.nextSong()},L=()=>{s.hasPrev&&s.prevSong()},V=()=>{const e=["order","random","repeat"],r=e.indexOf(v.value);v.value=e[(r+1)%e.length],console.log("切换播放模式:",{order:"顺序播放",random:"随机播放",repeat:"单曲循环"}[v.value])},$=()=>{M(),l.value=0,t.value=0,n.value=null,u.value=!1};return P(()=>s.currentSong,async(e,r)=>{if(e&&e.id!==(r==null?void 0:r.id)){console.log("歌曲变化，加载新歌曲:",e.name);try{const a=await S(e.id);a?(await y(a),r&&c.value&&g()):(n.value="无法获取歌曲播放链接",console.error("歌曲播放链接为空:",e.id))}catch(a){console.error("获取歌曲播放链接失败:",a),n.value="获取播放链接失败"}}},{immediate:!1}),P(m,e=>{o&&o.volume(e)}),{isPlaying:c,currentTime:l,duration:t,volume:m,playMode:v,isLoading:u,error:n,progressPercent:k,currentTimeFormatted:w,durationFormatted:T,initPlayer:y,play:g,pause:b,stop:M,seek:N,setVolume:U,togglePlayMode:V,nextSong:x,prevSong:L,resetPlayer:$}},{persist:{paths:["volume","playMode"]}});export{O as u};
//# sourceMappingURL=player-DkPa5aRc.js.map
