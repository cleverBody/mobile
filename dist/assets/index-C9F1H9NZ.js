import{d as K,r as $,m as W,c as X,u as Y,o as Z,aP as q,g as O,h as r,w as d,i as t,I as Q,j as n,J as tt,L as R,aT as st,K as et,A as k,z as C,l as S,az as U,M as at,y as m,S as y,k as l,C as lt,x as F,t as u,aU as ot,aV as nt,ao as j,aW as it,aX as E,F as ut,D as ct,E as rt,G as dt,at as mt,ax as vt,aS as bt,aY as pt,aZ as _t,_ as ft}from"./index-C9U6OB9Y.js";const ht=K("album",()=>{const _=$(null),x=$([]),I=$(!1);return{currentAlbum:_,albumSongs:x,loading:I,loadAlbum:async c=>{var w,z,D,V,B,P;if(!I.value){I.value=!0;try{const i=(await W.getAlbumDetail(c)).album;_.value={id:i.id,name:i.name,cover:i.picUrl||i.blurPicUrl,description:i.description,artist:((w=i.artist)==null?void 0:w.name)||((D=(z=i.artists)==null?void 0:z[0])==null?void 0:D.name)||"未知艺人",artistId:((V=i.artist)==null?void 0:V.id)||((P=(B=i.artists)==null?void 0:B[0])==null?void 0:P.id)||0,publishTime:i.publishTime||i.publishTime,company:i.company,songsCount:i.size||0,playCount:i.playCount,isSubscribed:i.subType===1},i.songs&&i.songs.length>0?x.value=i.songs.map((v,N)=>({id:v.id,name:v.name,artists:v.ar||v.artists||[],duration:Math.floor(v.dt/1e3)||v.duration,track:v.no||N+1,disc:v.cd||1,mv:v.mv||void 0,playCount:v.playCount})):x.value=[]}catch(g){throw console.error("加载专辑信息失败:",g),g}finally{I.value=!1}}},subscribeAlbum:async c=>{console.log("收藏专辑",c),_.value&&_.value.id===c&&(_.value.isSubscribed=!0)},unsubscribeAlbum:async c=>{console.log("取消收藏专辑",c),_.value&&_.value.id===c&&(_.value.isSubscribed=!1)},playAlbum:async(c,w=0)=>{console.log("播放专辑",c,"从第",w+1,"首开始")},clearAlbum:()=>{_.value=null,x.value=[]}}}),yt={key:0,class:"loading-container"},kt={key:1,class:"album-detail"},Ct={class:"album-header"},St={class:"album-cover"},gt=["src","alt"],At={class:"album-info"},xt={class:"album-name"},It={class:"album-stats"},wt={key:0},Tt={class:"album-actions"},zt={key:0,class:"album-description"},Bt={class:"songs-header"},Pt={class:"songs-title"},$t={class:"songs-count"},Mt={class:"songs-actions"},Dt={key:1,class:"batch-actions"},Vt={class:"batch-buttons"},Nt={class:"songs-list"},Ft={key:0,class:"song-checkbox"},Ot={key:1,class:"song-track"},Rt=["onClick"],Ut={class:"song-details"},jt={class:"song-name"},Et={class:"song-meta"},Lt={key:0},Gt={key:1},Ht={key:2},Jt={key:2,class:"song-actions"},Kt={class:"album-meta"},Wt={key:0,class:"meta-item"},Xt={class:"meta-value"},Yt={class:"meta-item"},Zt={class:"meta-value"},qt=X({__name:"index",setup(_){const x=q(),I=dt(),T=ht(),M=Y(),b=$(!1),f=$([]),{currentAlbum:e,albumSongs:c,loading:w}=T;Z(()=>{const a=parseInt(x.params.id);a&&T.loadAlbum(a)});const z=a=>a?a>=1e8?(a/1e8).toFixed(1)+"亿":a>=1e4?(a/1e4).toFixed(1)+"万":a.toString():"0",D=a=>{if(!a)return"00:00";const s=Math.floor(a/60),o=a%60;return`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},V=async()=>{if(e.value)try{e.value.isSubscribed?(await T.unsubscribeAlbum(e.value.id),p("已取消收藏")):(await T.subscribeAlbum(e.value.id),p("收藏成功"))}catch{p("操作失败")}},B=()=>{if(c.value.length>0){const a=c.value.map(s=>{var o;return{id:s.id,name:s.name,artists:s.artists,duration:s.duration,cover:(o=e.value)==null?void 0:o.cover,album:e.value?{id:e.value.id,name:e.value.name}:void 0}});M.setPlaylist(a,0)}},P=(a,s)=>{if(b.value){g(a.id);return}const o=c.value.map(h=>{var A;return{id:h.id,name:h.name,artists:h.artists,duration:h.duration,cover:(A=e.value)==null?void 0:A.cover,album:e.value?{id:e.value.id,name:e.value.name}:void 0}});M.setPlaylist(o,s)},g=a=>{const s=f.value.indexOf(a);s>-1?f.value.splice(s,1):f.value.push(a)},i=()=>{const a=c.value.filter(s=>f.value.includes(s.id));if(a.length>0){const s=a.map(o=>{var h;return{id:o.id,name:o.name,artists:o.artists,duration:o.duration,cover:(h=e.value)==null?void 0:h.cover,album:e.value?{id:e.value.id,name:e.value.name}:void 0}});M.setPlaylist(s,0),b.value=!1,f.value=[]}},v=()=>{p("功能开发中")},N=()=>{p("功能开发中")},L=async(a,s)=>{await(await _t.create({header:a.name,buttons:[{text:"立即播放",icon:F,handler:()=>P(a,s)},{text:"下一首播放",handler:()=>{p("已添加到下一首播放")}},{text:"添加到歌单",handler:()=>{p("功能开发中")}},{text:"下载",icon:j,handler:()=>{p("功能开发中")}},{text:"分享",icon:U,handler:()=>{p("功能开发中")}},{text:"取消",role:"cancel"}]})).present()},G=a=>{I.push(`/artist/${a}`)},H=()=>{p("功能开发中")},J=()=>{p("功能开发中")},p=async a=>{await(await mt.create({message:a,duration:2e3,position:"bottom"})).present()};return(a,s)=>(r(),O(t(Q),null,{default:d(()=>[n(t(at),null,{default:d(()=>[n(t(tt),null,{default:d(()=>[n(t(R),{slot:"start"},{default:d(()=>[n(t(st),{"default-href":"/tabs/discover"})]),_:1}),n(t(et),null,{default:d(()=>[...s[2]||(s[2]=[k("专辑详情",-1)])]),_:1}),n(t(R),{slot:"end"},{default:d(()=>[n(t(C),{fill:"clear",onClick:H},{default:d(()=>[n(t(S),{icon:t(U)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(t(rt),null,{default:d(()=>[t(w)?(r(),m("div",yt,[n(t(lt)),s[3]||(s[3]=l("p",null,"加载中...",-1))])):t(e)?(r(),m("div",kt,[l("div",Ct,[l("div",St,[l("img",{src:t(e).cover,alt:t(e).name},null,8,gt),l("div",{class:"play-button",onClick:B},[n(t(S),{icon:t(F)},null,8,["icon"])])]),l("div",At,[l("h1",xt,u(t(e).name),1),l("div",{class:"album-artist",onClick:s[0]||(s[0]=o=>G(t(e).artistId))},u(t(e).artist),1),l("div",It,[l("span",null,u(t(e).publishTime),1),l("span",null,u(t(e).songsCount)+"首",1),t(e).playCount?(r(),m("span",wt,u(z(t(e).playCount))+"播放",1)):y("",!0)]),l("div",Tt,[n(t(C),{color:t(e).isSubscribed?"medium":"primary",size:"small",onClick:V},{default:d(()=>[n(t(S),{icon:t(e).isSubscribed?t(ot):t(nt),slot:"start"},null,8,["icon"]),k(" "+u(t(e).isSubscribed?"已收藏":"收藏"),1)]),_:1},8,["color"]),n(t(C),{size:"small",fill:"outline",onClick:J},{default:d(()=>[n(t(S),{icon:t(j),slot:"start"},null,8,["icon"]),s[4]||(s[4]=k(" 下载 ",-1))]),_:1})])])]),t(e).description?(r(),m("div",zt,[s[5]||(s[5]=l("h3",null,"专辑简介",-1)),l("p",null,u(t(e).description),1)])):y("",!0),l("div",Bt,[l("div",Pt,[s[6]||(s[6]=l("h3",null,"歌曲列表",-1)),l("span",$t,u(t(c).length)+"首",1)]),l("div",Mt,[n(t(C),{fill:"clear",size:"small",onClick:B},{default:d(()=>[n(t(S),{icon:t(F),slot:"start"},null,8,["icon"]),s[7]||(s[7]=k(" 播放全部 ",-1))]),_:1}),n(t(C),{fill:"clear",size:"small",onClick:s[1]||(s[1]=o=>b.value=!b.value)},{default:d(()=>[n(t(S),{icon:b.value?t(it):t(E),slot:"start"},null,8,["icon"]),k(" "+u(b.value?"取消":"管理"),1)]),_:1})])]),b.value&&f.value.length>0?(r(),m("div",Dt,[l("span",null,"已选择 "+u(f.value.length)+" 首",1),l("div",Vt,[n(t(C),{size:"small",fill:"outline",onClick:i},{default:d(()=>[...s[8]||(s[8]=[k("播放",-1)])]),_:1}),n(t(C),{size:"small",fill:"outline",onClick:v},{default:d(()=>[...s[9]||(s[9]=[k("添加到歌单",-1)])]),_:1}),n(t(C),{size:"small",fill:"outline",onClick:N},{default:d(()=>[...s[10]||(s[10]=[k("下载",-1)])]),_:1})])])):y("",!0),l("div",Nt,[(r(!0),m(ut,null,ct(t(c),(o,h)=>(r(),m("div",{key:o.id,class:vt(["song-item",{"song-selected":f.value.includes(o.id)}])},[b.value?(r(),m("div",Ft,[n(t(bt),{checked:f.value.includes(o.id),onIonChange:A=>g(o.id)},null,8,["checked","onIonChange"])])):(r(),m("div",Ot,u(o.track),1)),l("div",{class:"song-info",onClick:A=>b.value?g(o.id):P(o,h)},[l("div",Ut,[l("h4",jt,[k(u(o.name)+" ",1),o.mv?(r(),O(t(S),{key:0,icon:t(pt),class:"mv-icon"},null,8,["icon"])):y("",!0)]),l("p",Et,[o.artists.length>1?(r(),m("span",Lt,u(o.artists.map(A=>A.name).join(" / ")),1)):y("",!0),o.duration?(r(),m("span",Gt,u(D(o.duration)),1)):y("",!0),o.playCount?(r(),m("span",Ht,u(z(o.playCount))+"播放",1)):y("",!0)])])],8,Rt),b.value?y("",!0):(r(),m("div",Jt,[n(t(C),{fill:"clear",size:"small",onClick:A=>L(o,h)},{default:d(()=>[n(t(S),{icon:t(E)},null,8,["icon"])]),_:1},8,["onClick"])]))],2))),128))]),l("div",Kt,[t(e).company?(r(),m("div",Wt,[s[11]||(s[11]=l("span",{class:"meta-label"},"发行公司",-1)),l("span",Xt,u(t(e).company),1)])):y("",!0),l("div",Yt,[s[12]||(s[12]=l("span",{class:"meta-label"},"发行时间",-1)),l("span",Zt,u(t(e).publishTime),1)])])])):y("",!0)]),_:1})]),_:1}))}}),ts=ft(qt,[["__scopeId","data-v-59b7303d"]]);export{ts as default};
//# sourceMappingURL=index-C9F1H9NZ.js.map
