import{d as Y,r as S,c as Z,u as q,e as j,o as ss,g as G,h as i,w as r,i as e,I as es,j as o,J as ts,L as as,z as $,l as C,aL as ls,aM as os,M as ns,k as t,y as c,S as x,F as H,D as T,A as V,aN as is,C as rs,n as cs,a1 as us,a2 as z,X as B,t as u,E as ds,G as vs,V as hs,Z as _s,a3 as Q,aI as ms,x as ps,Y as fs,v as ys,a4 as gs,B as ks,_ as Cs}from"./index-C9U6OB9Y.js";const Is=Y("search",()=>{const O=S([]),d=S([]),v=S({songs:[],artists:[],albums:[],playlists:[]}),y=S(!1),g=async()=>{try{const m=await(await fetch("http://localhost:3000/api/netease/search/hot/detail?realIP=116.25.146.177")).json();m.code===200&&m.data?O.value=m.data.map(p=>p.searchWord||p.first).slice(0,12):O.value=["周杰伦","陈奕迅","邓紫棋","林俊杰","稻香","十年","孤勇者","夜曲","华语流行","欧美金曲","日韩音乐"]}catch(_){console.error("加载热搜失败:",_),O.value=["周杰伦","陈奕迅","邓紫棋","林俊杰","稻香","十年","孤勇者","夜曲","华语流行","欧美金曲","日韩音乐"]}},k=async _=>{if(!y.value){y.value=!0;try{const p=await(await fetch(`http://localhost:3000/api/search/suggest?keywords=${encodeURIComponent(_)}&realIP=116.25.146.177`)).json();if(p.success&&p.data&&p.data.code===200&&p.data.result){const w=p.data.result,L=(w.songs||[]).map(l=>{var f,U;return{id:l.id,name:l.name,artists:l.artists||[],album:l.album,cover:((f=l.album)==null?void 0:f.picUrl)||((U=l.album)!=null&&U.picId?`https://p4.music.126.net/${l.album.picId}/${l.album.picId}.jpg?param=300y300`:""),duration:Math.floor((l.duration||0)/1e3)}}),N=(w.artists||[]).map(l=>({id:l.id,name:l.name,cover:l.picUrl||l.img1v1Url||"",followers:l.fansCount||0})),P=(w.albums||[]).map(l=>{var f;return{id:l.id,name:l.name,cover:l.picUrl||"",artist:((f=l.artist)==null?void 0:f.name)||"",releaseDate:l.publishTime?new Date(l.publishTime).toLocaleDateString():""}}),F=(w.playlists||[]).map(l=>{var f;return{id:l.id,name:l.name,cover:l.coverImgUrl||"",description:l.description||"",trackCount:l.trackCount||0,creator:((f=l.creator)==null?void 0:f.nickname)||""}});v.value={songs:L,artists:N,albums:P,playlists:F}}else b()}catch(m){console.error("搜索失败:",m),b()}finally{y.value=!1}}},b=()=>{v.value={songs:[],artists:[],albums:[],playlists:[]}};return{suggestions:O,history:d,results:v,loading:y,loadSuggestions:g,search:k,clearResults:b,addToHistory:_=>{const m=d.value.indexOf(_);m>-1&&d.value.splice(m,1),d.value.unshift(_),d.value.length>20&&(d.value=d.value.slice(0,20))},removeHistoryItem:_=>{d.value.splice(_,1)},clearHistory:()=>{d.value=[]}}},{persist:{paths:["history"]}}),bs={class:"search-page"},xs={key:0,class:"search-suggestions"},Ss={class:"suggestions-grid"},ws={key:1,class:"search-history"},$s={class:"history-header"},Hs={class:"history-list"},Ts=["onClick"],Vs={key:2,class:"search-results"},Os={key:0,class:"search-loading"},Bs={key:1,class:"no-results"},Ls={key:2,class:"results-content"},Us={key:0,class:"results-section"},Es={class:"songs-list"},Rs=["onClick"],Ms={class:"song-cover"},js=["src","alt"],zs={class:"play-overlay"},Ds={class:"song-info"},As={class:"song-name s-text-truncate"},Ns={class:"song-artist s-text-secondary s-text-truncate"},Ps={class:"song-actions"},Fs={key:1,class:"results-section"},Qs={class:"artists-grid"},Gs=["onClick"],Js={class:"artist-avatar"},Ks=["src","alt"],Ws={class:"artist-name s-text-truncate"},Xs={class:"artist-followers s-text-secondary"},Ys={key:2,class:"results-section"},Zs={class:"albums-grid"},qs=["onClick"],se={class:"album-cover"},ee=["src","alt"],te={class:"album-name s-text-truncate"},ae={class:"album-artist s-text-secondary s-text-truncate"},le={key:3,class:"results-section"},oe={class:"playlists-list"},ne=["onClick"],ie={class:"playlist-cover"},re=["src","alt"],ce={class:"playlist-info"},ue={class:"playlist-name s-text-truncate"},de={class:"playlist-desc s-text-secondary s-text-truncate"},ve={class:"playlist-count s-text-secondary"},he=Z({__name:"index",setup(O){const d=vs(),v=Is(),y=q(),g=S(""),k=S("songs"),b=S(!1),D=j(()=>v.suggestions),A=j(()=>v.history),h=j(()=>v.results),_=j(()=>{const a=h.value;return a.songs.length>0||a.artists.length>0||a.albums.length>0||a.playlists.length>0}),m=()=>{d.back()},p=async a=>{const n=a.detail.value.trim();if(!n){v.clearResults();return}b.value=!0;try{await v.search(n),v.addToHistory(n)}catch(s){console.error("搜索失败:",s)}finally{b.value=!1}},w=()=>{g.value="",v.clearResults()},L=a=>{g.value=a,p({detail:{value:a}})},N=()=>{v.clearHistory()},P=a=>{v.removeHistoryItem(a)},F=a=>{k.value=a.detail.value},l=(a,n)=>{const s=h.value.songs;y.setPlaylist(s,n)},f=a=>{y.toggleLike(a)},U=a=>{console.log("更多操作",a)},J=a=>{d.push(`/artist/${a}`)},K=a=>{d.push(`/album/${a}`)},W=a=>{d.push(`/playlist/${a}`)},X=a=>a?a>=1e4?Math.floor(a/1e4)+"万":a.toString():"0",E=a=>{const n=a.target;n.src.includes("default-cover")||(n.src="https://p4.music.126.net/6y-UleORITEDbvrOLV0Q8A==/5639395138885805.jpg")};return ss(()=>{v.loadSuggestions()}),(a,n)=>(i(),G(e(es),null,{default:r(()=>[o(e(ns),null,{default:r(()=>[o(e(ts),null,{default:r(()=>[o(e(as),{slot:"start"},{default:r(()=>[o(e($),{onClick:m},{default:r(()=>[o(e(C),{icon:e(ls)},null,8,["icon"])]),_:1})]),_:1}),o(e(os),{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=s=>g.value=s),placeholder:"搜索歌曲、歌手、专辑",debounce:300,onIonInput:p,onIonClear:w,"show-clear-button":"focus"},null,8,["modelValue"])]),_:1})]),_:1}),o(e(ds),{fullscreen:!0},{default:r(()=>[t("div",bs,[!g.value&&D.value.length>0?(i(),c("div",xs,[n[2]||(n[2]=t("h3",{class:"suggestions-title"},"热门搜索",-1)),t("div",Ss,[(i(!0),c(H,null,T(D.value,s=>(i(),G(e(hs),{key:s,onClick:I=>L(s),outline:""},{default:r(()=>[o(e(B),null,{default:r(()=>[V(u(s),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))])])):x("",!0),!g.value&&A.value.length>0?(i(),c("div",ws,[t("div",$s,[n[4]||(n[4]=t("h3",{class:"history-title"},"搜索历史",-1)),o(e($),{fill:"clear",size:"small",onClick:N},{default:r(()=>[o(e(C),{icon:e(is)},null,8,["icon"]),n[3]||(n[3]=V(" 清空 ",-1))]),_:1})]),t("div",Hs,[(i(!0),c(H,null,T(A.value,(s,I)=>(i(),c("div",{key:I,class:"history-item",onClick:R=>L(s)},[o(e(C),{icon:e(_s)},null,8,["icon"]),t("span",null,u(s),1),o(e($),{fill:"clear",size:"small",onClick:Q(R=>P(I),["stop"])},{default:r(()=>[o(e(C),{icon:e(ms)},null,8,["icon"])]),_:1},8,["onClick"])],8,Ts))),128))])])):x("",!0),g.value?(i(),c("div",Vs,[b.value?(i(),c("div",Os,[o(e(rs),{name:"circular"}),n[5]||(n[5]=t("p",null,"搜索中...",-1))])):_.value?(i(),c("div",Ls,[o(e(us),{modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=s=>k.value=s),onIonChange:F},{default:r(()=>[o(e(z),{value:"songs"},{default:r(()=>[o(e(B),null,{default:r(()=>[V("歌曲 ("+u(h.value.songs.length)+")",1)]),_:1})]),_:1}),o(e(z),{value:"artists"},{default:r(()=>[o(e(B),null,{default:r(()=>[V("歌手 ("+u(h.value.artists.length)+")",1)]),_:1})]),_:1}),o(e(z),{value:"albums"},{default:r(()=>[o(e(B),null,{default:r(()=>[V("专辑 ("+u(h.value.albums.length)+")",1)]),_:1})]),_:1}),o(e(z),{value:"playlists"},{default:r(()=>[o(e(B),null,{default:r(()=>[V("歌单 ("+u(h.value.playlists.length)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),k.value==="songs"?(i(),c("div",Us,[t("div",Es,[(i(!0),c(H,null,T(h.value.songs,(s,I)=>{var R;return i(),c("div",{key:s.id,class:"song-item",onClick:M=>l(s,I)},[t("div",Ms,[t("img",{src:s.cover,alt:s.name,onError:E},null,40,js),t("div",zs,[o(e(C),{icon:e(ps)},null,8,["icon"])])]),t("div",Ds,[t("h3",As,u(s.name),1),t("p",Ns,u((R=s.artists)==null?void 0:R.map(M=>M.name).join(", ")),1)]),t("div",Ps,[o(e($),{fill:"clear",size:"small",onClick:Q(M=>f(s.id),["stop"]),color:e(y).isLiked(s.id)?"primary":"medium"},{default:r(()=>[o(e(C),{icon:e(y).isLiked(s.id)?e(fs):e(ys)},null,8,["icon"])]),_:2},1032,["onClick","color"]),o(e($),{fill:"clear",size:"small",onClick:Q(M=>U(s),["stop"])},{default:r(()=>[o(e(C),{icon:e(gs)},null,8,["icon"])]),_:1},8,["onClick"])])],8,Rs)}),128))])])):x("",!0),k.value==="artists"?(i(),c("div",Fs,[t("div",Qs,[(i(!0),c(H,null,T(h.value.artists,s=>(i(),c("div",{key:s.id,class:"artist-card",onClick:I=>J(s.id)},[t("div",Js,[t("img",{src:s.cover,alt:s.name,onError:E},null,40,Ks)]),t("h3",Ws,u(s.name),1),t("p",Xs,u(X(s.followers))+"关注",1)],8,Gs))),128))])])):x("",!0),k.value==="albums"?(i(),c("div",Ys,[t("div",Zs,[(i(!0),c(H,null,T(h.value.albums,s=>(i(),c("div",{key:s.id,class:"album-card",onClick:I=>K(s.id)},[t("div",se,[t("img",{src:s.cover,alt:s.name,onError:E},null,40,ee)]),t("h3",te,u(s.name),1),t("p",ae,u(s.artist),1)],8,qs))),128))])])):x("",!0),k.value==="playlists"?(i(),c("div",le,[t("div",oe,[(i(!0),c(H,null,T(h.value.playlists,s=>(i(),c("div",{key:s.id,class:"playlist-item",onClick:I=>W(s.id)},[t("div",ie,[t("img",{src:s.cover,alt:s.name,onError:E},null,40,re)]),t("div",ce,[t("h3",ue,u(s.name),1),t("p",de,u(s.description),1),t("p",ve,u(s.trackCount)+"首歌曲",1)]),o(e($),{fill:"clear",size:"small"},{default:r(()=>[o(e(C),{icon:e(ks)},null,8,["icon"])]),_:1})],8,ne))),128))])])):x("",!0)])):(i(),c("div",Bs,[o(e(C),{icon:e(cs),class:"no-results-icon"},null,8,["icon"]),n[6]||(n[6]=t("h3",null,"未找到相关结果",-1)),n[7]||(n[7]=t("p",null,"尝试更换关键词或检查拼写",-1))]))])):x("",!0)])]),_:1})]),_:1}))}}),me=Cs(he,[["__scopeId","data-v-fbe72089"]]);export{me as default};
//# sourceMappingURL=index-DAkXgUzB.js.map
