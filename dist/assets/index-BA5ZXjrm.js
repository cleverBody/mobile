import{d as bl,r as k,m as ll,aO as sl,c as Pl,u as xl,e as x,aP as Il,o as wl,g as T,h as v,w as r,i as l,I as zl,j as e,k as s,y as p,S as el,H as Ol,z as d,l as c,aL as Tl,az as al,a4 as tl,x as L,t as y,A as I,Y as ol,v as nl,ao as il,aQ as Ll,aR as jl,C as El,F as Al,D as Bl,aa as Dl,a0 as Ml,E as Nl,G as Rl,ax as Vl,aS as $l,a3 as j,a8 as Fl,_ as Ul}from"./index-C9U6OB9Y.js";const Hl=bl("playlist",()=>{const S=k(null),m=k([]),b=k(!1);return{currentPlaylist:S,playlistSongs:m,loading:b,loadPlaylist:async u=>{var h;if(!b.value){b.value=!0;try{console.log("加载歌单:",u);const t=(await ll.getPlaylistDetail(u)).playlist;S.value={id:t.id,name:t.name,cover:t.coverImgUrl||t.picUrl,description:t.description,trackCount:t.trackCount||((h=t.tracks)==null?void 0:h.length)||0,playCount:t.playCount,createTime:new Date(t.createTime).toLocaleDateString(),updateTime:new Date(t.updateTime||t.createTime).toLocaleDateString(),creator:{id:t.creator.userId,name:t.creator.nickname,avatar:t.creator.avatarUrl},tags:t.tags||[]};try{const C=await ll.getPlaylistTracks(u,100);m.value=C.songs?C.songs.map(sl):[],console.log("歌单歌曲加载完成:",m.value.length)}catch(C){console.error("获取歌单歌曲失败:",C),t.tracks?m.value=t.tracks.map(sl):m.value=[]}}catch(n){throw console.error("加载歌单失败:",n),n}finally{b.value=!1}}},addSongToPlaylist:async(u,h)=>{console.log("添加歌曲到歌单",u,h)},removeSongFromPlaylist:async(u,h)=>{const n=m.value.findIndex(t=>t.id===h);n>-1&&(m.value.splice(n,1),S.value&&S.value.trackCount--)},subscribePlaylist:async u=>{console.log("收藏歌单",u)},unsubscribePlaylist:async u=>{console.log("取消收藏歌单",u)},clearPlaylist:()=>{S.value=null,m.value=[]}}}),Gl={class:"playlist-page"},Ql={class:"top-bar"},Yl={class:"top-actions"},ql={class:"hero-content"},Jl={class:"playlist-main"},Kl={class:"playlist-cover-container"},Wl={class:"playlist-cover"},Xl=["src","alt"],Zl={class:"play-button"},ls={class:"playlist-info"},ss={class:"playlist-title"},es={class:"creator-info"},as=["src","alt"],ts={class:"creator-name"},os={class:"playlist-stats"},ns={class:"hero-actions"},is={class:"action-row"},cs={class:"songs-section"},rs={class:"section-header"},us={class:"list-controls"},ds={key:0,class:"loading-container"},vs={key:1,class:"songs-list"},gs=["onClick"],ms={key:1,class:"song-index"},ps={key:0},ys={class:"song-main"},_s={class:"song-cover"},fs=["src","alt"],hs={class:"song-info"},ks={class:"song-name s-text-truncate"},Cs={class:"song-meta s-text-secondary s-text-truncate"},Ss={key:0},bs={class:"song-actions"},Ps={key:2,class:"empty-state"},xs={key:0,class:"batch-actions"},Is={class:"batch-info"},ws={class:"batch-buttons"},zs=Pl({__name:"index",setup(S){const m=Il(),b=Rl(),w=Hl(),_=xl(),z=k(!0),f=k(!1),g=k(new Set),O=k("asc"),u=k(!1),h=x(()=>Number(m.params.id)),n=x(()=>w.currentPlaylist),t=x(()=>w.playlistSongs),C=x(()=>_.currentSong),cl=x(()=>{const o=[...t.value];return O.value==="asc"?o:o.reverse()}),rl=()=>{b.back()},E=()=>{console.log("分享歌单")},ul=()=>{console.log("更多操作")},A=()=>{t.value.length>0&&_.setPlaylist(t.value,0)},dl=()=>{u.value=!u.value},vl=()=>{console.log("下载全部")},gl=()=>{O.value=O.value==="asc"?"desc":"asc"},ml=()=>{f.value=!f.value,f.value||g.value.clear()},pl=(o,a)=>{f.value?B(o.id):_.setPlaylist(t.value,a)},B=o=>{g.value.has(o)?g.value.delete(o):g.value.add(o)},yl=o=>{_.toggleLike(o)},_l=o=>{console.log("歌曲操作",o)},fl=()=>{const o=t.value.filter(a=>g.value.has(a.id));o.length>0&&_.setPlaylist(o,0),f.value=!1,g.value.clear()},hl=()=>{console.log("添加到歌单")},kl=()=>{console.log("下载选中")},Cl=o=>o?o>=1e4?Math.floor(o/1e4)+"万":o.toString():"0",D=o=>{const a=o.target;a.src="/images/album.jpg"},Sl=o=>{const a=o.target;a.src="/images/default-avatar.jpg"};return wl(async()=>{z.value=!0;try{await w.loadPlaylist(h.value),u.value=!1}catch(o){console.error("加载歌单失败:",o)}finally{z.value=!1}}),(o,a)=>(v(),T(l(zl),null,{default:r(()=>[e(l(Nl),{fullscreen:!0,class:"playlist-content"},{default:r(()=>{var M,N,R,V,$,F,U,H,G,Q,Y,q;return[s("div",Gl,[s("div",{class:"playlist-hero",style:Ol({backgroundImage:`url(${((M=n.value)==null?void 0:M.cover)||"/images/album.jpg"})`})},[a[3]||(a[3]=s("div",{class:"hero-overlay"},null,-1)),s("div",Ql,[e(l(d),{fill:"clear",color:"light",onClick:rl,class:"back-button"},{default:r(()=>[e(l(c),{icon:l(Tl)},null,8,["icon"])]),_:1}),s("div",Yl,[e(l(d),{fill:"clear",color:"light",onClick:E},{default:r(()=>[e(l(c),{icon:l(al)},null,8,["icon"])]),_:1}),e(l(d),{fill:"clear",color:"light",onClick:ul},{default:r(()=>[e(l(c),{icon:l(tl)},null,8,["icon"])]),_:1})])]),s("div",ql,[s("div",Jl,[s("div",Kl,[s("div",Wl,[s("img",{src:((N=n.value)==null?void 0:N.cover)||"/images/album.jpg",alt:(R=n.value)==null?void 0:R.name,onError:D},null,40,Xl),s("div",{class:"play-overlay",onClick:A},[s("div",Zl,[e(l(c),{icon:l(L)},null,8,["icon"])])])])]),s("div",ls,[s("h1",ss,y(((V=n.value)==null?void 0:V.name)||"加载中..."),1),s("div",es,[s("img",{src:((F=($=n.value)==null?void 0:$.creator)==null?void 0:F.avatar)||"/images/default-avatar.jpg",alt:(H=(U=n.value)==null?void 0:U.creator)==null?void 0:H.name,class:"creator-avatar",onError:Sl},null,40,as),s("span",ts,y((Q=(G=n.value)==null?void 0:G.creator)==null?void 0:Q.name),1)]),s("div",os,[s("span",null,y(((Y=n.value)==null?void 0:Y.trackCount)||0)+"首",1),a[1]||(a[1]=s("span",{class:"separator"},"•",-1)),s("span",null,y(Cl((q=n.value)==null?void 0:q.playCount))+"次播放",1)])])]),s("div",ns,[e(l(d),{expand:"block",class:"play-all-button",onClick:A,disabled:!t.value.length},{default:r(()=>[e(l(c),{icon:l(L),slot:"start"},null,8,["icon"]),a[2]||(a[2]=I(" 播放全部 ",-1))]),_:1},8,["disabled"]),s("div",is,[e(l(d),{fill:"clear",size:"small",color:"light",onClick:dl},{default:r(()=>[e(l(c),{icon:u.value?l(ol):l(nl)},null,8,["icon"])]),_:1},8,["color"]),e(l(d),{fill:"clear",size:"small",color:"light",onClick:vl},{default:r(()=>[e(l(c),{icon:l(il)},null,8,["icon"])]),_:1}),e(l(d),{fill:"clear",size:"small",color:"light",onClick:E},{default:r(()=>[e(l(c),{icon:l(al)},null,8,["icon"])]),_:1})])])])],4),s("div",cs,[s("div",rs,[a[4]||(a[4]=s("h2",{class:"section-title"},"歌曲列表",-1)),s("div",us,[e(l(d),{fill:"clear",size:"small",onClick:gl},{default:r(()=>[e(l(c),{icon:l(Ll)},null,8,["icon"])]),_:1}),e(l(d),{fill:"clear",size:"small",onClick:ml},{default:r(()=>[e(l(c),{icon:l(jl)},null,8,["icon"])]),_:1})])]),z.value?(v(),p("div",ds,[e(l(El),{name:"circular"}),a[5]||(a[5]=s("p",null,"加载中...",-1))])):t.value.length>0?(v(),p("div",vs,[(v(!0),p(Al,null,Bl(cl.value,(i,J)=>{var K,W,X,Z;return v(),p("div",{key:i.id,class:Vl(["song-item",{selected:g.value.has(i.id),playing:((K=C.value)==null?void 0:K.id)===i.id}]),onClick:P=>pl(i,J)},[f.value?(v(),T(l($l),{key:0,checked:g.value.has(i.id),onIonChange:P=>B(i.id),onClick:a[0]||(a[0]=j(()=>{},["stop"]))},null,8,["checked","onIonChange"])):(v(),p("div",ms,[((W=C.value)==null?void 0:W.id)!==i.id?(v(),p("span",ps,y(J+1),1)):(v(),T(l(c),{key:1,icon:l(Fl),color:"primary"},null,8,["icon"]))])),s("div",ys,[s("div",_s,[s("img",{src:i.cover||((X=n.value)==null?void 0:X.cover)||"/images/album.jpg",alt:i.name,onError:D},null,40,fs)]),s("div",hs,[s("h3",ks,y(i.name),1),s("p",Cs,[I(y((Z=i.artists)==null?void 0:Z.map(P=>P.name).join(", "))+" ",1),i.album?(v(),p("span",Ss," - "+y(i.album.name),1)):el("",!0)])])]),s("div",bs,[e(l(d),{fill:"clear",size:"small",onClick:j(P=>yl(i.id),["stop"]),color:l(_).isLiked(i.id)?"primary":"medium"},{default:r(()=>[e(l(c),{icon:l(_).isLiked(i.id)?l(ol):l(nl)},null,8,["icon"])]),_:2},1032,["onClick","color"]),e(l(d),{fill:"clear",size:"small",onClick:j(P=>_l(i),["stop"])},{default:r(()=>[e(l(c),{icon:l(tl)},null,8,["icon"])]),_:1},8,["onClick"])])],10,gs)}),128))])):(v(),p("div",Ps,[e(l(c),{icon:l(Dl),class:"empty-icon"},null,8,["icon"]),a[6]||(a[6]=s("h3",null,"暂无歌曲",-1)),a[7]||(a[7]=s("p",null,"这个歌单还没有添加任何歌曲",-1))]))]),f.value&&g.value.size>0?(v(),p("div",xs,[s("div",Is,[s("span",null,"已选择 "+y(g.value.size)+" 首歌曲",1)]),s("div",ws,[e(l(d),{fill:"clear",size:"small",onClick:fl},{default:r(()=>[e(l(c),{icon:l(L)},null,8,["icon"]),a[8]||(a[8]=I(" 播放 ",-1))]),_:1}),e(l(d),{fill:"clear",size:"small",onClick:hl},{default:r(()=>[e(l(c),{icon:l(Ml)},null,8,["icon"]),a[9]||(a[9]=I(" 添加到 ",-1))]),_:1}),e(l(d),{fill:"clear",size:"small",onClick:kl},{default:r(()=>[e(l(c),{icon:l(il)},null,8,["icon"]),a[10]||(a[10]=I(" 下载 ",-1))]),_:1})])])):el("",!0)])]}),_:1})]),_:1}))}}),Ts=Ul(zs,[["__scopeId","data-v-5840da4c"]]);export{Ts as default};
//# sourceMappingURL=index-BA5ZXjrm.js.map
