import{d,r as l}from"./index-C9U6OB9Y.js";const I=d("user",()=>{const a=l(!1),r=l(null),t=l(""),s=l(!1),n=l(!1),c=async e=>{n.value=!0;try{await v(e)}catch(o){throw console.error("登录失败:",o),o}finally{n.value=!1}},v=async e=>{if(await new Promise(o=>setTimeout(o,1500)),e.password!=="123456")throw new Error("用户名或密码错误");t.value="mock_token_"+Date.now(),a.value=!0,r.value={id:12345678,nickname:"音乐爱好者",avatar:"/images/default-avatar.jpg",signature:"音乐是我的生命",birthday:"1995-06-15",city:"深圳市",province:"广东省",gender:1,followCount:128,fansCount:256,playlistCount:15,level:8,vipType:0}},f=async(e,o,u)=>c({phone:e,password:o,captcha:u}),g=async(e,o)=>c({email:e,password:o}),m=async e=>(console.log("发送验证码到:",e),await new Promise(o=>setTimeout(o,1e3)),{success:!0}),y=async()=>{try{t.value="",a.value=!1,r.value=null,console.log("用户已登出")}catch(e){throw console.error("登出失败:",e),e}},h=async e=>{s.value=!0;try{await new Promise(o=>setTimeout(o,1e3)),r.value&&Object.assign(r.value,e),console.log("个人信息更新成功")}catch(o){throw console.error("更新个人信息失败:",o),o}finally{s.value=!1}},w=async()=>{if(a.value){s.value=!0;try{await new Promise(e=>setTimeout(e,800)),console.log("用户信息已刷新")}catch(e){console.error("刷新用户信息失败:",e)}finally{s.value=!1}}},p=()=>{const e=localStorage.getItem("user_token"),o=localStorage.getItem("user_profile");if(e&&o)try{t.value=e,r.value=JSON.parse(o),a.value=!0}catch(u){console.error("恢复登录状态失败:",u),i()}},i=()=>{localStorage.removeItem("user_token"),localStorage.removeItem("user_profile")};return{isLoggedIn:a,userProfile:r,token:t,loading:s,loginLoading:n,login:c,loginWithPhone:f,loginWithEmail:g,sendCaptcha:m,logout:y,updateProfile:h,refreshUserInfo:w,checkLoginStatus:p,saveToLocal:()=>{a.value&&t.value&&r.value?(localStorage.setItem("user_token",t.value),localStorage.setItem("user_profile",JSON.stringify(r.value))):i()}}},{persist:{paths:["isLoggedIn","userProfile","token"]}});export{I as u};
//# sourceMappingURL=user-C-PeXwOA.js.map
